# D-ID テストツール使用ガイド

D-ID APIが正しく動作するかをテストするための3つのスクリプトを用意しました。

---

## 📋 テストスクリプト一覧

### 1. `test_did_complete.py` ⭐ おすすめ
**完全テスト - 音声生成から動画生成まで一気に実行**

```bash
python test_did_complete.py
```

**処理フロー:**
1. テキストを入力
2. Cartesiaで音声生成
3. Cloudinaryにアップロード（WAV→MP3変換）
4. D-IDで動画生成
5. 動画URL取得

**メリット:**
- 最も簡単
- フルフローのテスト
- 問題の切り分けが容易

---

### 2. `test_did_standalone.py`
**D-ID単体テスト - URLを使って動画生成のみテスト**

```bash
python test_did_standalone.py
```

**使い方:**
- 既に音声URLと画像URLがある場合に使用
- D-IDだけを単独でテスト

**2つのモード:**
1. サンプルURLでテスト（D-ID公式画像使用）
2. カスタムURLでテスト（自分のURL使用）

---

### 3. `upload_test_files.py`
**ファイルアップロードツール - ローカルファイルをCloudinaryにアップロード**

```bash
python upload_test_files.py
```

**使い方:**
- ローカルの音声・画像ファイルをアップロード
- URLを取得して`test_did_standalone.py`で使用

**対応ファイル:**
- 音声: MP3, WAV等
- 画像: JPG, PNG等

---

## 🚀 おすすめの使い方

### パターンA: まずは完全テスト（最も簡単）⭐

```bash
python test_did_complete.py
```

1. 短いテキストを入力（例: "こんにちは、テストです"）
2. 自動で音声生成
3. 自動でアップロード
4. D-IDで動画生成
5. 動画URLが表示される → ブラウザで確認

**メリット:** 全フローが動作するか一気に確認できる

---

### パターンB: D-IDだけをテスト

#### ステップ1: 音声ファイルをアップロード

既にMP3ファイルがある場合：

```bash
python upload_test_files.py
```

音声ファイルのパスを入力すると、CloudinaryのURLが表示されます。

#### ステップ2: D-IDテスト

```bash
python test_did_standalone.py
```

取得したURLを入力してテストします。

---

## 📝 テスト例

### 例1: 完全テスト

```bash
$ python test_did_complete.py

============================================================
D-ID 完全テスト（音声生成 → 動画生成）
============================================================

ステップ1: テキスト入力
------------------------------------------------------------
短いテキストを入力してください（例: こんにちは、テストです）
テキスト: こんにちは、テストです

ステップ2: 音声生成（Cartesia）
------------------------------------------------------------
音声生成中: こんにちは、テストです
✅ 音声生成成功: C:\dev\AIアバター\test_output.wav
   時間: 2.5秒

ステップ3: 音声アップロード（Cloudinary）
------------------------------------------------------------
Cloudinaryにアップロード中...
✅ アップロード成功: https://res.cloudinary.com/.../audio.mp3

ステップ4: アバター画像URL
------------------------------------------------------------
アバター画像URLを選択してください：
1. D-ID公式サンプル（Alice）
2. カスタムURL（自分の画像）

選択 (1 or 2): 1

ステップ5: 動画生成（D-ID）
------------------------------------------------------------
動画生成リクエスト送信中...
（最大5分かかる場合があります）

============================================================
✅ 完全成功！
============================================================

動画URL: https://d-id-talks-prod.s3.amazonaws.com/.../video.mp4
動画時間: 2.5秒
解像度: 1920x1080

総処理時間: 45.3秒

動画URLをブラウザで開いて確認してください
```

---

## 🐛 トラブルシューティング

### エラー: ModuleNotFoundError

```bash
pip install -r requirements.txt
```

### エラー: D-ID API 500エラー

**原因の可能性:**
1. 音声ファイルがMP3ではない（WAVのまま）
2. URLが無効
3. Cloudinary変換が未完了

**解決策:**
- `test_did_complete.py`を使用（自動でMP3変換されます）
- URLをブラウザで開いて確認
- 数秒待ってから再試行

### エラー: 音声URLにアクセスできない

**原因:** Cloudinaryの変換が完了していない

**解決策:**
- `upload_test_files.py`は自動で変換完了を待ちます
- 手動アップロードの場合は数秒待ってください

---

## ✅ 期待される結果

### 成功時

```
✅ 完全成功！

動画URL: https://d-id-talks-prod.s3.amazonaws.com/.../video.mp4
```

このURLをブラウザで開くと、アバターが音声に合わせて口を動かしている動画が再生されます。

### 失敗時

エラーメッセージと詳細情報が表示されます：
- HTTPステータスコード
- エラーレスポンス
- エラータイプ

---

## 📞 次のステップ

### テスト成功後

1. Streamlitアプリでテスト
2. 長いスクリプトでテスト
3. 本番運用開始

### テスト失敗時

1. エラーメッセージを確認
2. 音声URLをブラウザで開いて確認
3. D-ID APIキーを確認（`.streamlit/secrets.toml`）
4. Cloudinary設定を確認

---

**作成日:** 2025年11月15日
**目的:** D-ID API動作確認
