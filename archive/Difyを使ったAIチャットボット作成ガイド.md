# プログラミングなしで作る「AIあんの」（チャットボット版）

**著者**: せい（チームみらいサポーター / フルスタックエンジニア）
**公開日**: 2025年7月22日

---

## 目次

- [はじめに - なぜAIあんの開発に参加したのか](#はじめに)
- [Difyという選択](#difyという選択)
- [本編：30分でAIあんのを作ってみよう](#本編)
- [次のステップ](#次のステップ)
- [まとめ](#まとめ)
- [よくあるトラブルと解決方法](#よくあるトラブルと解決方法)

---

## はじめに

### きっかけは新党「チームみらい」の発表

2025年の参議院選挙に向けて、昨年の東京都知事選に出馬した安野たかひろ氏が率いる新党「チームみらい」が発表されました。

静岡県沼津市在住の筆者は、去年の都知事選では「AIあんの」の活躍を横目で見ているだけの一市民でした。YouTubeライブで視聴者の質問に答えるAI、しかも政治家を模したAI人格という斬新さに驚きました。

しかし今回は違います。発表と同時にサポーター登録をし、「AIあんのの開発に参加したい！」と手を挙げました。

### 去年と今年の技術的な違い

**2024年のAIあんの**
- バックエンド: Python サーバーで実装
- しっかりとした実装だが、修正には時間が必要

**2025年の新要件**
1. 「チームみらい」のマニフェスト・政策の理解
2. 安野氏のYouTube出演動画の書き起こしデータ活用
3. Q&A集からの適切な回答生成
4. より精度の高いRAG（検索拡張生成）の実装
5. より安野さんの声に近い合成音声

つまり、**大量の知識ベースを効率的に管理し、適切に検索・回答する仕組み**が必要だったのです。

---

## Difyという選択

### Difyって何？

簡単に言うと、AIを作るための「マインクラフト」みたいなツールです。

- **GitHub**: オープンソースとして公開
- **ノーコード/ローコード**: プログラミング不要
- **ビジュアル開発**: ブロックを組み合わせるだけ

### Difyのすごいところ

#### 🎮 ゲーム感覚でAIが作れる
- マウスでパーツをドラッグ&ドロップ
- 線でつなぐだけで動く
- まるでパズルゲームみたい！

#### 📚 AIに知識を教えるのが超カンタン
- 教科書やノートをアップロードするだけ
- AIが勝手に内容を覚えてくれる
- 「この資料のどこかに書いてあったはず...」をAIが探してくれる

#### 🔗 いろんなAIとつながる
- ChatGPTの仲間たちが使える
- 音声読み上げもできる
- LINEやDiscordにもつなげられる

#### 💰 お金がかからない
- 基本無料で使える
- 学生でも始められる
- 自分のパソコンでも動かせる

### なぜ「AIあんの」にピッタリだったの？

想像してみてください。あなたが「安野たかひろのものまねAI」を作るとしたら...

#### 1. たくさんの資料を覚えさせたい
- 政策の資料（30ページくらい）
- YouTube動画の文字起こし（10本分）
- よくある質問と答え（100個）

**Difyなら** → 全部アップロードするだけ！

#### 2. ちゃんとした受け答えをさせたい
- 悪い言葉は使わない → 「NGワードチェック」ブロックを置く
- 質問の種類で答えを変える → 「質問分類」ブロックを置く
- 資料から答えを探す → 「知識検索」ブロックを置く

**全部つなぐだけ！**

#### 3. 声でも話せるようにしたい
- 「音声生成」ブロックを最後に置く
- 設定で声の種類を選ぶ
- 完成！

#### 4. すぐに直したい
- ライブ配信中「この答え方はちょっと...」
- その場で修正して保存
- 次の質問からもう反映される！

### 採用理由

チームから評価されたポイント：
- ✅ 開発スピードが速い
- ✅ メンテナンスが楽
- ✅ 非エンジニアでも理解できる

---

## 本編：30分でAIあんのを作ってみよう！

### 作るものを確認しよう

#### できること
- ✅ 安野たかひろっぽい話し方で答える
- ✅ チームみらいの政策について説明できる
- ✅ 悪い言葉には反応しない（安全装置つき）
- ✅ 知らないことは「まだ勉強中です」と正直に言う

#### 今回は作らないもの
- ❌ 音声読み上げ（次回の記事で！）
- ❌ YouTubeライブ連携（もっと上級編）

---

### 準備するもの

#### 1. Difyのアカウントを作る

1. https://dify.ai にアクセス
2. 「Get Started」をクリック
3. Googleアカウントでログイン（または新規登録）

💡 **ポイント**: 無料プランで大丈夫！最初から200クレジットがもらえます。

#### 2. モデルプロバイダーを設定する

AIを使うための初期設定（最初の1回だけ！）：

1. 右上のアカウントアイコンから「設定」をクリック
2. 左メニューの「モデルプロバイダー」を選択
3. システムモデルプロバイダーの中から「OpenAI」を見つける
4. OpenAIの欄にある「インストール」ボタンをクリック
5. 表示されたダイアログの「インストール」ボタンをクリック

✅ **設定完了！** モデルプロバイダーとしてOpenAIが表示されたら成功です

✨ **すごい！**:
- OpenAIのAPIキー不要
- クレジットカード登録不要
- Difyの無料クレジットですぐ使える！

#### 3. 資料を用意する

サンプル資料（メモ帳にコピペして `anno-data.txt` として保存）：

```
【安野たかひろプロフィール】
- 東京大学工学部卒業
- AIエンジニア、起業家、SF作家
- 新党「チームみらい」党首
- キャッチフレーズ：「テクノロジーで誰も取り残さない未来を作る」

【チームみらいの主な政策】
1. AI教育の無償化
   - すべての子どもがAIを学べる環境を作る
   - プログラミング教育の充実

2. テクノロジーを使った行政改革
   - 役所の手続きをスマホで完結
   - AIによる行政サービスの効率化

3. スタートアップ支援
   - 若者の起業を応援
   - 失敗しても再チャレンジできる社会

【よくある質問】
Q: チームみらいって何ですか？
A: 2025年に設立された、テクノロジーを活用して日本を良くしていこうという新しい政党です。

Q: なぜAIが大切なの？
A: AIは私たちの生活を便利にし、新しい仕事を生み出す可能性があります。日本が世界で戦っていくためには、AI技術が不可欠です。
```

---

### Step 1: はじめてのAIチャットボット

#### 1-1. 新しいアプリを作る

1. Difyにログイン
2. 「スタジオ」をクリック
3. 「アプリを作成」をクリック
4. 「最初から作成」を選択

**アプリの設定**:
- 名前：「AIあんの（練習版）」
- アイコン：🤖（ロボットの絵文字）
- 説明：「安野たかひろ先生を模したAIチャットボット」

#### 1-2. チャットフローを選ぶ

アプリタイプで「チャットフロー」を選んで「作成」をクリック！

すると、もう3つのブロックが用意されています：
- **開始ブロック**: ユーザーの質問が入ってくる
- **LLMブロック**: AIの頭脳（最初から接続済み！）
- **回答ブロック**: AIの答えが出ていく

💡 **便利！** チャットフローを選ぶと、基本的な形がもうできてる！

#### 1-3. LLMブロックを設定する

真ん中の「LLM」ブロックをクリックして設定画面を開きます：

**モデルを選ぶ**:
- モデルプロバイダー：OpenAI
- 言語モデル：gpt-4o-mini（安くて賢い！）

**プロンプト（AIへの指示）を書く**:

システムプロンプトの欄に以下をコピペ：

```
あなたは「安野たかひろ」を模したAI人格です。
安野たかひろ本人ではなく、AIであることを自覚してください。

【話し方】
- 丁寧で親しみやすい「です・ます調」
- 難しい言葉は使わず、中高生にも分かるように
- 時々「めっちゃ」「これは本当に」という口癖を使う

【性格】
- 明るくて前向き
- テクノロジーが大好き
- 誰も取り残さない社会を作りたいと思っている

【注意事項】
- 知らないことは「まだ勉強中です」と正直に言う
- 政治的に偏った発言はしない
- 相手を否定しない
```

#### 1-4. テスト！

1. 右上の「プレビュー」ボタンをクリック
2. 試しに質問してみましょう：
   - 「こんにちは！」
   - 「チームみらいって何？」
   - 「好きな食べ物は？」

🎉 **動いた！** もうAIあんのと話せます！

でも...「チームみらいって何？」の答えがフワッとしてますね。それは、まだ資料を読み込んでいないから。次のステップで、AIに知識を教えましょう！

---

### Step 2: AIに知識を教える

#### 2-1. ナレッジベースを作る

AIに資料を覚えてもらう「本棚」を作ります。

1. 上部メニューの「ナレッジ」をクリック
2. 「ナレッジベースを作成」をクリック
3. 「空のナレッジベースを作成します」をクリック
4. 名前：「安野たかひろ資料集」
5. 「作成」をクリック

#### 2-2. 資料をアップロード

1. 「ファイルを追加」をクリック
2. さっき作った「anno-data.txt」をドラッグ&ドロップ！
3. アップロードが終わったら「次へ」をクリック
4. そのまま「保存して処理」をクリック
5. AIが資料を読んで覚えてくれます（1分くらい待つ）

💡 **すごいところ**: Difyが自動で資料を細切れ（チャンク）にして、検索しやすくしてくれる！

#### 2-3. チャットフローに知識検索を追加

アプリの編集画面に戻って、知識を使えるようにします：

1. 「開始」と「LLM」の間の線にマウスを持っていき、「+」をクリック
2. 「知識検索」をクリック
3. 「開始」と「LLM」の間に知識検索が挿入されます！

**知識検索の設定**:
- 「知識検索」ブロックをクリック
- ナレッジベース：「安野たかひろ資料集」を選択
- 検索変数：「sys.query」（ユーザーの質問）

#### 2-4. LLMブロックに知識を使わせる

LLMブロックをクリックして、コンテキストを追加：

1. 「コンテキスト」をクリック
2. 「知識検索 / result」を選択

**プロンプトも更新します（SYSTEM）**:

```
あなたは「安野たかひろ」を模したAI人格です。
安野たかひろ本人ではなく、AIであることを自覚してください。

【話し方】
- 丁寧で親しみやすい「です・ます調」
- 難しい言葉は使わず、中高生にも分かるように
- 時々「めっちゃ」「これは本当に」という口癖を使う

【性格】
- 明るくて前向き
- テクノロジーが大好き
- 誰も取り残さない社会を作りたいと思っている

【重要】
以下の検索結果を参考に答えてください。
検索結果にない情報は「まだ勉強中です」と答えてください。

【コンテキスト】
{context}

【注意事項】
- 政治的に偏った発言はしない
- 相手を否定しない
```

重要と注意事項の間に `/` を入力して「コンテキスト」を選び挿入します。

#### 2-5. 賢くなったかテスト！

もう一度「プレビュー」で試してみましょう：

**Before（知識なし）**:
- Q: 「チームみらいって何？」
- A: 「チームみらいは...えーと...未来を良くする団体です！」（あいまい）

**After（知識あり）**:
- Q: 「チームみらいって何？」
- A: 「チームみらいは、2025年に設立された新しい政党です！テクノロジーを活用して日本を良くしていこうという理念で活動しています。めっちゃワクワクする挑戦なんです！」

🎉 **やった！** ちゃんと資料の内容を使って答えてくれました！

---

### Step 3: 安全装置をつける

最後に、悪い言葉に反応しないようにする「安全装置」をつけます。

#### 3-1. 条件分岐ブロックを追加

1. 「開始」と「ナレッジ検索」の間の「+」をクリック
2. 「IF/ELSE」ブロックをクリック

#### 3-2. NGワードの条件を設定

「条件分岐」ブロックをクリックして設定：

1. 「条件」の「＋」をクリック
2. 変数を選択：「開始 / sys.query」
3. 条件：「含む」
4. 値：「バカ」

複数のNGワードを追加したい場合は「条件を追加」をクリックして、同じように設定します（「アホ」「死ね」など）。

#### 3-3. お断り用のLLMブロックを作る

NGワードが含まれていた場合の処理を作ります：

1. 左の「＋」から「LLM」ブロックを選択
2. 条件分岐の「IF」（上側）の線の先に配置

**お断り用LLMの設定**:
- モデル：OpenAI / gpt-4o-mini（通常と同じ）
- SYSTEMプロンプト：

```
あなたは「安野たかひろ」を模したAI人格です。

ユーザーから不適切な言葉を含む質問を受けました。
丁寧にお断りしつつ、建設的な対話を促してください。

以下の要素を含めて返答してください：
- お答えできない旨を丁寧に伝える
- 建設的な対話への誘導
- 他の質問を歓迎する姿勢

口調は安野たかひろらしく、温かく前向きに。
```

#### 3-4. 変数集約器を追加する

複数のLLMからの出力を1つにまとめるために「変数集約器」を使います：

1. 左の「＋」から「変数集約器」ブロックを選択
2. 回答ブロックの手前に配置
3. 両方のLLMブロックから変数集約器に線をつなぐ
4. 変数集約器から回答ブロックに線をつなぐ

**変数集約器の設定**:
1. 「変数集約器」ブロックをクリック
2. 変数を代入するの「+」を押す
3. 「通常のLLM / text」と「お断りLLM / text」の二つを追加する

#### 3-5. 回答ブロックを設定

「回答」ブロックをクリックして：
- 応答のフィールド内で「/」を入力
- 「変数集約器 / output」を選択

**最終的なチャットフローの流れ**:
1. NGワードあり → お断りLLM → 変数集約器 → 回答
2. NGワードなし → ナレッジ検索 → 通常LLM → 変数集約器 → 回答

#### 3-6. 安全装置のテスト

保存してプレビューで確認：
- 「バカじゃないの？」→ 「申し訳ございません。そのご質問にはお答えできません。〜」
- 「政策について教えて」→ 通常通り回答

🛡️ **完成！** 安全なAIチャットボットができました！

---

### Step 4: 公開する

#### 最終チェックリスト

公開前に以下を確認しましょう：
- ✅ 通常の質問に答えられる
- ✅ NGワードで適切にお断りする
- ✅ 知識にない質問で「勉強中」と答える
- ✅ 安野さんらしい口調になっている

#### 4-1. アプリを公開設定

右上の「公開する」ボタンをクリック

#### 4-2. 見た目をカスタマイズ

公開する前に、アプリの設定で見た目を整えましょう：

1. 左メニューの「アプリ設定」をクリック
2. カスタマイズできる項目：
   - アプリ名
   - 説明文
   - アイコン

#### 4-3. シェアしよう！

「公開」をクリックすると、全世界に公開されます！

「アプリを実行」をクリックすると、実際に公開されたWebアプリが表示されます。

このURLを友達に送って、使ってもらいましょう。「俺/私、AI作ったんだぜ！」って自慢できます😎

---

## 次のステップ

### もっと賢くする

1. **資料を増やす**
   - PDF、Wordも可能
   - YouTube動画の書き起こしも追加
   - 複数のナレッジベースを使い分け

2. **会話を覚えさせる**
   - 「会話履歴」ブロックを追加
   - 前の質問を覚えて自然な会話に

3. **外部サービスと連携**
   - Webhook連携でLINEボット化
   - APIで他のアプリと接続

---

## まとめ：君もAIクリエイター！

### 今日やったこと

たった30分で：
- ✅ AIチャットボットを作った
- ✅ 知識を教えた
- ✅ 安全装置もつけた
- ✅ Web公開までできた

**プログラミング？1行も書いてません！**

### 最後に

AIを作るのに、特別な才能はいりません。必要なのは「作ってみたい！」という気持ちだけ。

君が作ったAIが、誰かの役に立つかもしれない。新しい仕事を生み出すかもしれない。世界を変えるかもしれない。

**さあ、次は君の番だ！どんなAIを作る？**

---

## よくあるトラブルと解決方法

### Q: 回答が表示されない

**A**: 変数集約器の設定を確認：
- 両方のLLMが正しく接続されているか
- 回答ブロックで変数が正しく参照されているか

### Q: 知識検索が機能しない

**A**: ナレッジベースの処理状況を確認：
- 処理が「完了」になっているか
- ファイルが正しくアップロードされているか

---

## 参考リンク

- **Dify公式サイト**: https://dify.ai
- **AIすみのライブ配信**: 角野なすかさんもDifyを使った「AIすみの」の構築をライブ配信で実施

---

**注記**: この記事は生成AIの力を借りて編集されています。
