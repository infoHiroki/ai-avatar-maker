# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆæ›¸

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: ãƒ–ãƒ­ã‚°è¨˜äº‹â†’YouTubeå‹•ç”»è‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ä½œæˆæ—¥**: 2025å¹´11æœˆ15æ—¥

---

## ğŸ“‹ ç›®æ¬¡

1. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ–¹é‡](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ–¹é‡)
2. [APIã‚­ãƒ¼ç®¡ç†](#apiã‚­ãƒ¼ç®¡ç†)
3. [èªè¨¼ãƒ»èªå¯](#èªè¨¼èªå¯)
4. [ãƒ‡ãƒ¼ã‚¿ä¿è­·](#ãƒ‡ãƒ¼ã‚¿ä¿è­·)
5. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ–¹é‡

### åŸºæœ¬åŸå‰‡

```yaml
æœ€å°æ¨©é™ã®åŸå‰‡:
  - å¿…è¦æœ€å°é™ã®APIã‚¹ã‚³ãƒ¼ãƒ—ã®ã¿ä½¿ç”¨
  - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã¯å¿…è¦ãªç¯„å›²ã®ã¿

é˜²å¾¡ã®æ·±ã•:
  - è¤‡æ•°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã®ä¿è­·
  - APIã‚­ãƒ¼ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–

ã‚»ã‚­ãƒ¥ã‚¢ãƒã‚¤ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ:
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚»ã‚­ãƒ¥ã‚¢ãªè¨­å®š
  - Private GitHubãƒªãƒã‚¸ãƒˆãƒª
  - YouTubeå‹•ç”»ã¯ä¸‹æ›¸ãæŠ•ç¨¿
```

---

## APIã‚­ãƒ¼ç®¡ç†

### Streamlit Secretsï¼ˆæ¨å¥¨ï¼‰

**å ´æ‰€**: `.streamlit/secrets.toml`

```toml
# âŒ Gitç®¡ç†ã—ãªã„ï¼ˆ.gitignoreå¿…é ˆï¼‰
# âœ… Streamlit Cloudãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§è¨­å®š

[openai]
api_key = "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

[cartesia]
api_key = "cart_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
voice_id = "voice_xxxxxxxxxxxxxxxxxxxxx"

[did]
api_key = "did_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

[cloudinary]
cloud_name = "your_cloud_name"
api_key = "123456789012345"
api_secret = "xxxxxxxxxxxxxxxxxxxxxx"

[youtube]
# OAuthèªè¨¼æƒ…å ±ã¯åˆ¥ç®¡ç†ï¼ˆä¸‹è¨˜å‚ç…§ï¼‰

[app]
# ã‚ªãƒ—ã‚·ãƒ§ãƒ³: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
password = "your_secure_password_here"
```

### ã‚³ãƒ¼ãƒ‰ã§ã®ä½¿ç”¨æ–¹æ³•

```python
import streamlit as st

# âœ… OK: Streamlit Secretsã‹ã‚‰å–å¾—
openai_api_key = st.secrets["openai"]["api_key"]
cartesia_api_key = st.secrets["cartesia"]["api_key"]

# âŒ NG: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
openai_api_key = "sk-xxxxx"  # çµ¶å¯¾ã«ã—ãªã„ï¼
```

### .gitignoreè¨­å®š

```
# .gitignore
.streamlit/secrets.toml
.env
credentials.json
*.pem
*.key
```

### ç’°å¢ƒå¤‰æ•°ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼‰

```python
import os
from dotenv import load_dotenv

load_dotenv()  # .envãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿

# ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼ˆfallbackï¼‰
api_key = st.secrets.get("openai", {}).get("api_key") or os.getenv("OPENAI_API_KEY")
```

### secrets.toml.exampleï¼ˆGitç®¡ç†OKï¼‰

```toml
# .streamlit/secrets.toml.example
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ .streamlit/secrets.toml ã‚’ä½œæˆ

[openai]
api_key = "your-openai-api-key-here"

[cartesia]
api_key = "your-cartesia-api-key-here"
voice_id = "your-voice-id-here"

[did]
api_key = "your-did-api-key-here"

[cloudinary]
cloud_name = "your-cloud-name"
api_key = "your-api-key"
api_secret = "your-api-secret"

[app]
password = "set-a-secure-password"  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³
```

---

## èªè¨¼ãƒ»èªå¯

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«èªè¨¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼

```python
import streamlit as st
import hashlib

def check_password():
    """ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼"""

    def password_entered():
        """ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼"""
        # ãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦æ¯”è¼ƒï¼ˆå¹³æ–‡ä¿å­˜ã‚’é¿ã‘ã‚‹ï¼‰
        hashed_input = hashlib.sha256(
            st.session_state["password"].encode()
        ).hexdigest()

        expected_hash = hashlib.sha256(
            st.secrets["app"]["password"].encode()
        ).hexdigest()

        if hashed_input == expected_hash:
            st.session_state["password_correct"] = True
            del st.session_state["password"]  # ãƒ¡ãƒ¢ãƒªã‹ã‚‰å‰Šé™¤
        else:
            st.session_state["password_correct"] = False

    # æ—¢ã«èªè¨¼æ¸ˆã¿
    if st.session_state.get("password_correct", False):
        return True

    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
    st.text_input(
        "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",
        type="password",
        on_change=password_entered,
        key="password"
    )

    if "password_correct" in st.session_state:
        st.error("âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™")

    return False


# app.py
def main():
    if not check_password():
        st.stop()

    # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
    run_app()
```

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å+ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼

```python
def check_credentials():
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼å+ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼"""

    def credentials_entered():
        """èªè¨¼æƒ…å ±æ¤œè¨¼"""
        username = st.session_state["username"]
        password = st.session_state["password"]

        # ãƒãƒƒã‚·ãƒ¥åŒ–
        password_hash = hashlib.sha256(password.encode()).hexdigest()

        # Secretsã‹ã‚‰æ¤œè¨¼
        users = st.secrets.get("users", {})
        expected_hash = users.get(username, {}).get("password_hash", "")

        if password_hash == expected_hash:
            st.session_state["authenticated"] = True
            st.session_state["username"] = username
            # ãƒ¡ãƒ¢ãƒªã‹ã‚‰å‰Šé™¤
            del st.session_state["password"]
        else:
            st.session_state["authenticated"] = False

    if st.session_state.get("authenticated", False):
        return True

    st.text_input("ãƒ¦ãƒ¼ã‚¶ãƒ¼å", key="username")
    st.text_input(
        "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",
        type="password",
        on_change=credentials_entered,
        key="password"
    )

    if st.button("ãƒ­ã‚°ã‚¤ãƒ³"):
        credentials_entered()

    if st.session_state.get("authenticated") == False:
        st.error("âŒ èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ")

    return False
```

```toml
# secrets.toml
[users.admin]
password_hash = "5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8"  # "password"ã®SHA256

[users.editor]
password_hash = "..."
```

### YouTube OAuth 2.0

```python
from google_auth_oauthlib.flow import InstalledAppFlow
from google.oauth2.credentials import Credentials
import os

SCOPES = ["https://www.googleapis.com/auth/youtube.upload"]

def get_youtube_credentials():
    """YouTube OAuthèªè¨¼"""

    # credentials.json ã¯ Gitç®¡ç†ã—ãªã„
    if not os.path.exists("credentials.json"):
        st.error("""
        ### âŒ OAuthèªè¨¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“

        Google Cloud Consoleã§èªè¨¼æƒ…å ±ã‚’ä½œæˆã—ã€
        `credentials.json` ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚

        [æ‰‹é †ã‚’è¦‹ã‚‹](/docs/youtube-oauth-setup.md)
        """)
        st.stop()

    # ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜ï¼ˆå†èªè¨¼ã‚’é¿ã‘ã‚‹ï¼‰
    if os.path.exists("token.json"):
        creds = Credentials.from_authorized_user_file("token.json", SCOPES)
        return creds

    # åˆå›èªè¨¼
    flow = InstalledAppFlow.from_client_secrets_file(
        "credentials.json",
        SCOPES
    )
    creds = flow.run_local_server(port=0)

    # ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜
    with open("token.json", "w") as token:
        token.write(creds.to_json())

    return creds
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„**:
- `credentials.json` ã¯Gitç®¡ç†ã—ãªã„
- `token.json` ã‚‚ Gitç®¡ç†ã—ãªã„
- Streamlit Cloudã§ã¯ Secrets ã¨ã—ã¦è¨­å®š

---

## ãƒ‡ãƒ¼ã‚¿ä¿è­·

### æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„

```yaml
æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿:
  - APIã‚­ãƒ¼
  - OAuth ãƒˆãƒ¼ã‚¯ãƒ³
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰

ä¿è­·æ–¹æ³•:
  âœ… Streamlit Secrets
  âœ… ç’°å¢ƒå¤‰æ•°
  âœ… ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰
  âŒ Gitç®¡ç†ã—ãªã„
  âŒ ãƒ­ã‚°å‡ºåŠ›ã—ãªã„
  âŒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã«é€ä¿¡ã—ãªã„
```

### ãƒ­ã‚°ã‹ã‚‰ã®æ©Ÿå¯†æƒ…å ±é™¤å¤–

```python
import logging
import re

class SensitiveDataFilter(logging.Filter):
    """æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚¹ã‚¯ã™ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼"""

    def filter(self, record):
        # APIã‚­ãƒ¼ã‚’ãƒã‚¹ã‚¯
        message = record.getMessage()
        message = re.sub(
            r'(sk-|cart_|did_)[a-zA-Z0-9]{20,}',
            r'\1***',
            message
        )
        record.msg = message
        return True

# ãƒ­ã‚¬ãƒ¼ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¿½åŠ 
logger = logging.getLogger(__name__)
logger.addFilter(SensitiveDataFilter())
```

### ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®å®‰å…¨ãªå‰Šé™¤

```python
import os
import tempfile

def safe_temp_file():
    """å®‰å…¨ãªä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†"""
    try:
        # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
        with tempfile.NamedTemporaryFile(delete=False, suffix=".mp3") as tmp:
            tmp_path = tmp.name
            # ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
            yield tmp_path
    finally:
        # ç¢ºå®Ÿã«å‰Šé™¤
        if os.path.exists(tmp_path):
            os.unlink(tmp_path)

# ä½¿ç”¨ä¾‹
with safe_temp_file() as audio_path:
    save_audio(audio_path)
    upload_to_cloudinary(audio_path)
    # ã“ã“ã§è‡ªå‹•å‰Šé™¤
```

### HTTPSé€šä¿¡ã®å¼·åˆ¶

```python
# ã™ã¹ã¦ã®APIå‘¼ã³å‡ºã—ã¯HTTPS
OPENAI_API_URL = "https://api.openai.com/v1"  # âœ…
DID_API_URL = "https://api.d-id.com"  # âœ…

# HTTPã¯ä½¿ç”¨ã—ãªã„
# âŒ http://api.example.com
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ã‚³ãƒ¼ãƒ‰å®Ÿè£…æ™‚

```yaml
âœ… APIã‚­ãƒ¼ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãªã—
âœ… Streamlit Secretsä½¿ç”¨
âœ… .gitignoreã§æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«é™¤å¤–
âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ãƒãƒƒã‚·ãƒ¥åŒ–
âœ… ãƒ­ã‚°ã«æ©Ÿå¯†æƒ…å ±ã‚’å‡ºåŠ›ã—ãªã„
âœ… ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºå®Ÿã«å‰Šé™¤
âœ… HTTPSé€šä¿¡ã®ã¿
âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚ãªã„
```

### ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚

```yaml
âœ… Private GitHubãƒªãƒã‚¸ãƒˆãƒª
âœ… Streamlit Cloud Secretsã«å…¨APIã‚­ãƒ¼è¨­å®š
âœ… YouTube OAuthèªè¨¼æƒ…å ±ã®å®‰å…¨ãªç®¡ç†
âœ… ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ï¼‰
âœ… ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒŸãƒƒãƒˆç¢ºèª
```

### é‹ç”¨æ™‚

```yaml
âœ… APIã‚­ãƒ¼ã®å®šæœŸçš„ãªãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¹´1å›ï¼‰
âœ… ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®ç›£è¦–
âœ… ç•°å¸¸ãªAPIä½¿ç”¨é‡ã®æ¤œçŸ¥
âœ… YouTubeå‹•ç”»ã®å…¬é–‹è¨­å®šç¢ºèªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: Privateï¼‰
```

### ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ

```yaml
APIã‚­ãƒ¼æ¼æ´©æ™‚:
  1. å³åº§ã«APIã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–
  2. æ–°ã—ã„APIã‚­ãƒ¼ã‚’ç™ºè¡Œ
  3. Streamlit Secretsã‚’æ›´æ–°
  4. éå»ã®ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã‚’ç¢ºèª
  5. å¿…è¦ã«å¿œã˜ã¦Gitãƒªãƒã‚¸ãƒˆãƒªã‚’å‰Šé™¤ãƒ»å†ä½œæˆ

ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥æ™‚:
  1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸€æ™‚åœæ­¢
  2. ãƒ­ã‚°ã‚’ç¢ºèª
  3. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´
  4. Streamlit Cloudã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’ç¢ºèª
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ç¢ºèªé …ç›®

```python
# âŒ NG: æ©Ÿå¯†æƒ…å ±ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
api_key = "sk-xxxxx"

# âœ… OK: Secretsã‹ã‚‰å–å¾—
api_key = st.secrets["openai"]["api_key"]


# âŒ NG: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¹³æ–‡ä¿å­˜
if password == "my_password":
    pass

# âœ… OK: ãƒãƒƒã‚·ãƒ¥åŒ–
if hashlib.sha256(password.encode()).hexdigest() == expected_hash:
    pass


# âŒ NG: ãƒ­ã‚°ã«æ©Ÿå¯†æƒ…å ±
logger.info(f"API key: {api_key}")

# âœ… OK: ãƒã‚¹ã‚¯
logger.info(f"API key: {api_key[:7]}***")
```

### Gitç®¡ç†å‰ã®ç¢ºèª

```bash
# æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
git diff

# .gitignoreã®ç¢ºèª
cat .gitignore

# ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
git status

# secrets.tomlãŒé™¤å¤–ã•ã‚Œã¦ã„ã‚‹ã‹
git check-ignore .streamlit/secrets.toml
# â†’ å‡ºåŠ›ã•ã‚Œã‚Œã°OK
```

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ15æ—¥
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: ãƒ‡ãƒ—ãƒ­ã‚¤å‰
